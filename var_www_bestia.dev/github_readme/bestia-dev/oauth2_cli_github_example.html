<!DOCTYPE html>
<html>

<head>
    <title>oauth2_cli_github_example</title>
    <meta http-equiv="Content-type" content="text/html;charset=utf-8" />
    <meta name="Description" content="Example of GitHub api with Oauth2 CLI">
    <meta name="author" content="https://github.com/bestia-dev">
    <meta name=viewport content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/bestia01.css">
    <script>
        /* Toggle between adding and removing the "responsive" class to navbar when the user clicks on the hamburger */
        function toggle_responsive_navbar() {
            var x = document.getElementById("navbar");
            if (x.className.includes(" responsive")) {
                x.className = x.className.replace(" responsive", "");
            } else {
                x.className += " responsive";
            }
        }
    </script>
</head>

<body>
    <div class="fixed_header">
        <div id="navbar">
            <a id="navbar_brand" href="https://bestia.dev">
                <img src="bestia_icon.png" alt="Bestia development" title="bestia.dev" />
                <span id="navbar_title"> Bestia dev</span>
            </a>
            <a id="navbar_hamburger" href="javascript:void(0);" onclick="toggle_responsive_navbar()">‚ò∞ </a>
            <div id="navbar_topics">
                <a href="/index.html#home" onclick="toggle_responsive_navbar()">Home </a>
                <a href="/index.html#tutorials" onclick="toggle_responsive_navbar()">Tutorials</a>
                <a href="/index.html#games" onclick="toggle_responsive_navbar()">Games</a>
                <a href="/index.html#productivity" onclick="toggle_responsive_navbar()">Productivity</a>
                <a href="/index.html#contact" onclick="toggle_responsive_navbar()">Contact</a>
            </div>
        </div>
    </div>
    <div>&nbsp;</div> 
    <div class="small">This is a copy of the Github readme.<br/>
    Find the original on <a href="https://github.com/bestia-dev/oauth2_cli_github_example">https://github.com/bestia-dev/oauth2_cli_github_example</a></div>

<article class="markdown-body entry-content container-lg" itemprop="text">
<div class="markdown-heading" dir="auto"><h1 tabindex="-1" class="heading-element" dir="auto">oauth2_cli_github_example</h1><a id="user-content-oauth2_cli_github_example" class="anchor" aria-label="Permalink: oauth2_cli_github_example" href="#oauth2_cli_github_example"></a></div>
<p dir="auto"><strong>Example of GitHub api with Oauth2 CLI</strong><br>
<em><strong>version: 2025.310.1800 date: 2025-03-10 author: <a href="https://bestia.dev" rel="nofollow">bestia.dev</a> repository: <a href="https://github.com/bestia-dev/oauth2_cli_github_example">GitHub</a></strong></em></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/73ed04c398eacfa6db03184d92a4980c9e5618bf6994b483ab49ab3d7e1969ee/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f776f726b5f696e5f70726f67726573732d79656c6c6f77"><img src="https://img.shields.io/badge/work_in_progress-yellow" alt="work-in-progress" style="max-width: 100%;"></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/0b77e90cabb00ba69158dfe4b5595a26880baffc97b34d0328db7d53202d9711/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f7475746f7269616c2d6f72616e6765"><img src="https://img.shields.io/badge/tutorial-orange" alt="tutorial" style="max-width: 100%;"></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/041c52befc2afdfb44210e38cd6de6e4e6cecc95d973d88791f9533a6aacfbb5/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6f61757468322d6f72616e6765"><img src="https://img.shields.io/badge/oauth2-orange" alt="oauth2" style="max-width: 100%;"></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/7e4018d06e6c45fbac1b04ad391646c049d64f68c955ebdae53cf72dc1f9ac56/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f636c692d6f72616e6765"><img src="https://img.shields.io/badge/cli-orange" alt="cli" style="max-width: 100%;"></a></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/6581c31c16c1b13ddc2efb92e2ad69a93ddc4a92fd871ff15d401c4c6c9155a4/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6c6963656e73652d4d49542d626c75652e737667"><img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="License" style="max-width: 100%;"></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/4857de6513dbbc6473bfe1632c251d3c460e85c39d341d4d294c9191c0b361ff/68747470733a2f2f6265737469612e6465762f776562706167655f6869745f636f756e7465722f6765745f7376675f696d6167652f313039363437393337362e737667"><img src="https://bestia.dev/webpage_hit_counter/get_svg_image/1096479376.svg" alt="oauth2_cli_github_example" style="max-width: 100%;"></a></p>
<p dir="auto">Hashtags: #tutorial #oauth #rust #cli<br>
My projects on GitHub are more like a tutorial than a finished product: <a href="https://github.com/bestia-dev/tutorials_rust_wasm">bestia-dev tutorials</a>.</p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">Motivation</h2><a id="user-content-motivation" class="anchor" aria-label="Permalink: Motivation" href="#motivation"></a></div>
<p dir="auto">I want to use the GitHub api to automate the build and release workflow of my rust projects.<br>
I used a personal secret token, but this is now short lived, cumbersome to generate and not recommended anymore.<br>
Oauth2 is now recommended.</p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">Github app</h2><a id="user-content-github-app" class="anchor" aria-label="Permalink: Github app" href="#github-app"></a></div>
<p dir="auto">Github has the concept of <a href="https://docs.github.com/en/apps/creating-github-apps/about-creating-github-apps/about-creating-github-apps">GitHub app</a></p>
<p dir="auto">In the settings of GitHub create a new GitHub App <a href="https://github.com/settings/apps">https://github.com/settings/apps</a>.<br>
App name: oauth2-cli-github-example<br>
The name cannot contain underscore!<br>
Homepage URL: <a href="https://bestia.dev/oauth2_cli_github_example/homepage.html" rel="nofollow">https://bestia.dev/oauth2_cli_github_example/homepage.html</a><br>
Callback URL: <a href="https://bestia.dev/oauth2_cli_github_example/callback.html" rel="nofollow">https://bestia.dev/oauth2_cli_github_example/callback.html</a></p>
<p dir="auto">Enable device flow: this is mandatory for CLI applications</p>
<p dir="auto">Repository permission
Contents: read and write<br>
Repository contents, commits, branches, downloads, releases, and merges.<br>
Metadata  mandatory: read only<br>
Search repositories, list collaborators, and access repository metadata.</p>
<p dir="auto">App ID: xxx<br>
Using your App ID to get installation tokens? You can now use your Client ID instead.<br>
Client ID: xxx</p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">Device workflow with Oauth</h2><a id="user-content-device-workflow-with-oauth" class="anchor" aria-label="Permalink: Device workflow with Oauth" href="#device-workflow-with-oauth"></a></div>
<p dir="auto">There are many different workflows in Oauth2. That makes it so confusing.<br>
For a CLI program it is recommended the <code>device workflow</code>. This must be enabled when creating the GitHub app.</p>
<p dir="auto">I will save the tokens in a file encrypted with an SSH key.</p>
<p dir="auto">For every app start check if the tokens are still valid and if needed <a href="https://docs.github.com/en/apps/creating-github-apps/authenticating-with-a-github-app/refreshing-user-access-tokens">use the refresh_token</a>.<br>
In case of any error start the "workflow to authentication with the browser".</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="Check if the file with encrypted tokens is present
  Decrypt the tokens
  Check if the access_token is still valid
    store access_token in global variable for use
  Else check if the refresh_token is valid
    Send the request to obtain new tokens
    Save the tokens encrypted with an SSH key
    store access_token in global variable for use"><pre lang="plaintext" class="notranslate"><code>Check if the file with encrypted tokens is present
  Decrypt the tokens
  Check if the access_token is still valid
    store access_token in global variable for use
  Else check if the refresh_token is valid
    Send the request to obtain new tokens
    Save the tokens encrypted with an SSH key
    store access_token in global variable for use
</code></pre></div>
<p dir="auto">Workflow to <a href="https://docs.github.com/en/apps/creating-github-apps/authenticating-with-a-github-app/generating-a-user-access-token-for-a-github-app#using-the-device-flow-to-generate-a-user-access-token">authentication with the browser</a> for <a href="https://docs.github.com/en/apps/oauth-apps/building-oauth-apps/authorizing-oauth-apps#device-flow">device flow</a>:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="In the CLI program send a request to GitHub with client_id
Get a response with  device_code and user_code
Open a browser on GitHub, authenticate and type the user_code
GitHub will prepare the tokens on the server
Return to the CLI program and send a request to GitHub with  client_id and device_code
Get a response with access_token and refresh_token
Save the tokens encrypted with an SSH key"><pre lang="plaintext" class="notranslate"><code>In the CLI program send a request to GitHub with client_id
Get a response with  device_code and user_code
Open a browser on GitHub, authenticate and type the user_code
GitHub will prepare the tokens on the server
Return to the CLI program and send a request to GitHub with  client_id and device_code
Get a response with access_token and refresh_token
Save the tokens encrypted with an SSH key
</code></pre></div>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">Open-source and free as a beer</h2><a id="user-content-open-source-and-free-as-a-beer" class="anchor" aria-label="Permalink: Open-source and free as a beer" href="#open-source-and-free-as-a-beer"></a></div>
<p dir="auto">My open-source projects are free as a beer (MIT license).<br>
I just love programming.<br>
But I need also to drink. If you find my projects and tutorials helpful, please buy me a beer by donating to my <a href="https://paypal.me/LucianoBestia" rel="nofollow">PayPal</a>.<br>
You know the price of a beer in your local bar ;-)<br>
So I can drink a free beer for your health :-)<br>
<a href="https://translate.google.com/?hl=en&amp;sl=sl&amp;tl=en&amp;text=Na%20zdravje&amp;op=translate" rel="nofollow">Na zdravje!</a> <a href="https://dictionary.cambridge.org/dictionary/italian-english/alla-salute" rel="nofollow">Alla salute!</a> <a href="https://dictionary.cambridge.org/dictionary/german-english/prost" rel="nofollow">Prost!</a> <a href="https://matadornetwork.com/nights/how-to-say-cheers-in-50-languages/" rel="nofollow">Nazdravlje!</a> üçª</p>
<p dir="auto"><a href="https://bestia.dev" rel="nofollow">//bestia.dev</a><br>
<a href="https://github.com/bestia-dev">//github.com/bestia-dev</a><br>
<a href="https://bestiadev.substack.com" rel="nofollow">//bestiadev.substack.com</a><br>
<a href="https://youtube.com/@bestia-dev-tutorials" rel="nofollow">//youtube.com/@bestia-dev-tutorials</a></p>
</article>
</body>

</html>