<!DOCTYPE html>
<html>

<head>
    <title>dropbox_backup_to_external_disk_cli</title>
    <meta http-equiv="Content-type" content="text/html;charset=utf-8" />
    <meta name="Description" content="CLI binary executable, one-way sync from Dropbox to external disc">
    <meta name="author" content="https://github.com/bestia-dev">
    <meta name=viewport content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/bestia01.css">
</head>

<body>
    <header>
        <nav>
            <a href="https://bestia.dev/index.html">bestia.dev</a>
        </nav>
    </header>
    <div>&nbsp;</div> 
    <div class="small"><a id="navbar_brand" href="https://bestia.dev" style="justify-content: center;">
                <img src="https://bestia.dev/images/bestia_icon.png" alt="bestia.dev" title="bestia.dev" />
            </a>This is a copy of the Github readme. Find the original on <a href="https://github.com/bestia-dev/dropbox_backup_to_external_disk_cli">https://github.com/bestia-dev/dropbox_backup_to_external_disk_cli</a></div>

<article class="markdown-body entry-content container-lg" itemprop="text">
<div class="markdown-heading" dir="auto"><h1 tabindex="-1" class="heading-element" dir="auto">dropbox_backup_to_external_disk_cli</h1><a id="user-content-dropbox_backup_to_external_disk_cli" class="anchor" aria-label="Permalink: dropbox_backup_to_external_disk_cli" href="#dropbox_backup_to_external_disk_cli"></a></div>
<p dir="auto"><strong>CLI binary executable, one-way sync from Dropbox to external disc</strong><br>
<em><strong>version: 2024.927.907 date: 2024-09-27 author: <a href="https://bestia.dev" rel="nofollow">bestia.dev</a> repository: <a href="https://github.com/bestia-dev/dropbox_backup_to_external_disk_cli/">GitHub</a></strong></em></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/afa7193528806db731bfe7b1e302d6cc40601fed8cce48379b780cd8c7d01a74/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f64726f70626f782d6f72616e6765"><img src="https://img.shields.io/badge/dropbox-orange" alt="dropbox" style="max-width: 100%;"></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/e8100395d149fab3d02c3ee4672d2cc5d833bf4ab9044e6c57f47c54baf4d1ba/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6d61696e7461696e65642d677265656e"><img src="https://img.shields.io/badge/maintained-green" alt="maintained" style="max-width: 100%;"></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/c066cc507aa545ffb3e29f51862d44cea438e2616f2b06d903a92f85eee3ee7e/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f776f726b5f696e5f70726f67726573732d6f72616e6765"><img src="https://img.shields.io/badge/work_in_progress-orange" alt="work_in_progress" style="max-width: 100%;"></a></p>
<p dir="auto"><a href="https://github.com/bestia-dev/dropbox_backup_to_external_disk_cli/"><img src="https://img.shields.io/badge/Lines_in_Rust-649-green.svg" alt="Lines in Rust code" style="max-width: 100%;"></a>
<a href="https://github.com/bestia-dev/dropbox_backup_to_external_disk_cli/"><img src="https://img.shields.io/badge/Lines_in_Doc_comments-35-blue.svg" alt="Lines in Doc comments" style="max-width: 100%;"></a>
<a href="https://github.com/bestia-dev/dropbox_backup_to_external_disk_cli/"><img src="https://img.shields.io/badge/Lines_in_comments-117-purple.svg" alt="Lines in Comments" style="max-width: 100%;"></a>
<a href="https://github.com/bestia-dev/dropbox_backup_to_external_disk_cli/"><img src="https://img.shields.io/badge/Lines_in_examples-0-yellow.svg" alt="Lines in examples" style="max-width: 100%;"></a>
<a href="https://github.com/bestia-dev/dropbox_backup_to_external_disk_cli/"><img src="https://img.shields.io/badge/Lines_in_tests-0-orange.svg" alt="Lines in tests" style="max-width: 100%;"></a></p>
<p dir="auto"><a href="https://github.com/bestia-dev/dropbox_backup_to_external_disk_2/blob/main/LICENSE"><img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="License" style="max-width: 100%;"></a>
<a href="https://github.com/bestia-dev/dropbox_backup_to_external_disk_2/"><img src="https://github.com/bestia-dev/dropbox_backup_to_external_disk_2/workflows/rust_fmt_auto_build_test/badge.svg" alt="Rust" style="max-width: 100%;"></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/371cb11e6b41f79b230b1b679f0a5ebc54ec4dbad4f3a986d7d3d1f55a7c59fd/68747470733a2f2f6265737469612e6465762f776562706167655f6869745f636f756e7465722f6765745f7376675f696d6167652f3737323734353735362e737667"><img src="https://bestia.dev/webpage_hit_counter/get_svg_image/772745756.svg" alt="dropbox_backup_to_external_disk_cli" style="max-width: 100%;"></a></p>
<p dir="auto">Hashtags: #rustlang #tutorial #dropbox #maintained #work_in_progress #cli
My projects on Github are more like a tutorial than a finished product: <a href="https://github.com/bestia-dev/tutorials_rust_wasm">bestia-dev tutorials</a>.</p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">CLI</h2><a id="user-content-cli" class="anchor" aria-label="Permalink: CLI" href="#cli"></a></div>
<p dir="auto">This compiles into a CLI binary executable. All the user interface is inside this project.<br>
The main dependency is to the library project <code>dropbox_backup_to_external_disk_lib</code> that contains all the program logic.  I separated this projects to show how to use the same library from different binary projects. It is difficult to separate this two layers afterwards. They should be separated from the start.<br>
Different user-interfaces need different workflows and the common library must allow this. Modern computers and phones are all multi-core. Even javascript has multi-thread capabilities with web-workers. It is recommended to create multi-threaded applications. Most of the calls to the library will be done in a separate thread to have the possibility of communication between the 2 layers (UI and logic). For example for progress bars and similar long running tasks.</p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">Cross compile to windows</h2><a id="user-content-cross-compile-to-windows" class="anchor" aria-label="Permalink: Cross compile to windows" href="#cross-compile-to-windows"></a></div>
<p dir="auto">On my machine I have Windows11 with WSL/Debian. My external drive is exFAT and it works nice with windows. But from WSL it does not work well. WSL/Debian cannot change the datetime of files on the external drive.</p>
<p dir="auto">Therefore I will cross compile to Windows, copy the exe file with <code>scp</code> and run it on Windows.</p>
<p dir="auto">From Windows it takes cold 16 seconds and hot 2 seconds to list the Local external drive folder. In WSL it takes forever.</p>
<p dir="auto">Copy the exe file from the container 'crustde' to win folder. Run in windows git-bash:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="scp rustdevuser@crustde:/home/rustdevuser/rustprojects/dropbox_backup_to_external_disk_cli/target/x86_64-pc-windows-gnu/release/dropbox_backup_to_external_disk_cli.exe /c/Users/Luciano/rustprojects/dropbox_backup_to_external_disk/

# then run the local_list with the path like this in git-bash
cd rustprojects/dropbox_backup_to_external_disk
alias dropbox_backup_to_external_disk_cli=./dropbox_backup_to_external_disk_cli
complete -C &quot;dropbox_backup_to_external_disk_cli completion&quot; dropbox_backup_to_external_disk_cli

"><pre>scp rustdevuser@crustde:/home/rustdevuser/rustprojects/dropbox_backup_to_external_disk_cli/target/x86_64-pc-windows-gnu/release/dropbox_backup_to_external_disk_cli.exe /c/Users/Luciano/rustprojects/dropbox_backup_to_external_disk/

<span class="pl-c"><span class="pl-c">#</span> then run the local_list with the path like this in git-bash</span>
<span class="pl-c1">cd</span> rustprojects/dropbox_backup_to_external_disk
<span class="pl-c1">alias</span> dropbox_backup_to_external_disk_cli=./dropbox_backup_to_external_disk_cli
<span class="pl-c1">complete</span> -C <span class="pl-s"><span class="pl-pds">"</span>dropbox_backup_to_external_disk_cli completion<span class="pl-pds">"</span></span> dropbox_backup_to_external_disk_cli

</pre></div>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">Development</h2><a id="user-content-development" class="anchor" aria-label="Permalink: Development" href="#development"></a></div>
<p dir="auto">I use <code>cargo-auto</code> to write all repetitive tasks in <code>automation_tasks_rs</code>.</p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">Try it</h2><a id="user-content-try-it" class="anchor" aria-label="Permalink: Try it" href="#try-it"></a></div>
<p dir="auto">There are a few manual steps for the security of you files on Dropbox. Authentication on internet is a complex topic.<br>
You should be logged in Linux terminal (also in WSL2) with your account. So things you do in that session, are not visible to others. You will set some local environment variables that are private/secret to your linux Session.  After you logout from you Linux session these local environment variables will be deleted.<br>
The executable will create a sub-directory <code>tmp/temp_data</code> in the current directory. Maybe it is best if you create a dedicated directory <code>~/dropbox_backup_to_external_disk_cli/</code> just for this executable and tmp/temp_data.
Download the latest release from <a href="https://github.com/bestia-dev/dropbox_backup_to_external_disk_lib/releases">Github</a> and make the file executable and enable auto-completion:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="cd ~
mkdir dropbox_backup_to_external_disk_cli
cd dropbox_backup_to_external_disk_cli

curl -L https://github.com/bestia-dev/dropbox_backup_to_external_disk_lib/releases/latest/download/dropbox_backup_to_external_disk_cli --output dropbox_backup_to_external_disk_cli

chmod +x dropbox_backup_to_external_disk_cli
alias dropbox_backup_to_external_disk_cli=./dropbox_backup_to_external_disk_cli
complete -C &quot;dropbox_backup_to_external_disk_cli completion&quot; dropbox_backup_to_external_disk_cli

dropbox_backup_to_external_disk_cli"><pre><span class="pl-c1">cd</span> <span class="pl-k">~</span>
mkdir dropbox_backup_to_external_disk_cli
<span class="pl-c1">cd</span> dropbox_backup_to_external_disk_cli

curl -L https://github.com/bestia-dev/dropbox_backup_to_external_disk_lib/releases/latest/download/dropbox_backup_to_external_disk_cli --output dropbox_backup_to_external_disk_cli

chmod +x dropbox_backup_to_external_disk_cli
<span class="pl-c1">alias</span> dropbox_backup_to_external_disk_cli=./dropbox_backup_to_external_disk_cli
<span class="pl-c1">complete</span> -C <span class="pl-s"><span class="pl-pds">"</span>dropbox_backup_to_external_disk_cli completion<span class="pl-pds">"</span></span> dropbox_backup_to_external_disk_cli

dropbox_backup_to_external_disk_cli</pre></div>
<p dir="auto">Run the executable without arguments and follow carefully the instructions.</p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">Warning</h2><a id="user-content-warning" class="anchor" aria-label="Permalink: Warning" href="#warning"></a></div>
<p dir="auto">I don't know why, but WSL2 sometimes does not see all the folders of the external disk.<br>
Instead of 12.000 folders it sees only 28 ???<br>
Be careful !<br>
Check it first with this commands to see if the removable disk is really mounted or you see a phantom cached file system.</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="ls /mnt/d
# and/or
df"><pre>ls /mnt/d
<span class="pl-c"><span class="pl-c">#</span> and/or</span>
df</pre></div>
<p dir="auto">I then restart my Win10 and the problem magically disappears.</p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">bash auto-completion</h2><a id="user-content-bash-auto-completion" class="anchor" aria-label="Permalink: bash auto-completion" href="#bash-auto-completion"></a></div>
<p dir="auto">This executable is prepared for auto-completion in bash.<br>
Run this command to define auto-completion in bash for the current session:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="alias dropbox_backup_to_external_disk_cli=./dropbox_backup_to_external_disk_cli
complete -C &quot;dropbox_backup_to_external_disk_cli completion&quot; dropbox_backup_to_external_disk_cli"><pre><span class="pl-c1">alias</span> dropbox_backup_to_external_disk_cli=./dropbox_backup_to_external_disk_cli
<span class="pl-c1">complete</span> -C <span class="pl-s"><span class="pl-pds">"</span>dropbox_backup_to_external_disk_cli completion<span class="pl-pds">"</span></span> dropbox_backup_to_external_disk_cli</pre></div>
<p dir="auto">To make it permanent add this command to the file <code>~/.bashrc</code> or some other file that runs commands on bash initialization.</p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">Authorization OAuth2</h2><a id="user-content-authorization-oauth2" class="anchor" aria-label="Permalink: Authorization OAuth2" href="#authorization-oauth2"></a></div>
<p dir="auto">Authorization on the internet is a mess. Dropbox api uses OAuth2.
Every app must be authorized on Dropbox and have its own <code>app key</code> and <code>app secret</code>.<br>
For commercial programs they probably embed them into the binary code somehow. But for OpenSource projects it is not possible to keep a secret. So the workaround is: every user must create its own new <code>dropbox app</code> exclusive only to him. Creating a new app is simple. This app will stay forever in <code>development status</code> in dropbox, to be more private and secure. The<br>
<code>$ dropbox_backup_to_external_disk_cli --help</code><br>
has the detailed instructions.<br>
Then every time before use we need generate the "short-lived access token" for security reasons. There is the possibility to choose "no expiration" token, but I don't like it. Dropbox backup is used rarely and it is not super frustrating to make few clicks for security of your precious files. Having a "no expiration" token is like having another password for the hackers to try to hack. I like more the "short-lived" token. When I'm not using this backup program, there is no access token at all.<br>
TODO: use the complete OAuth protocol instead of short-lived token</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/bestia-dev/dropbox_backup_to_external_disk_lib/raw/main/images/dropbox_2.png"><img src="https://github.com/bestia-dev/dropbox_backup_to_external_disk_lib/raw/main/images/dropbox_2.png" alt="dropbox_2" title="dropbox_2" style="max-width: 100%;"></a> <a target="_blank" rel="noopener noreferrer" href="https://github.com/bestia-dev/dropbox_backup_to_external_disk_lib/raw/main/images/dropbox_1.png"><img src="https://github.com/bestia-dev/dropbox_backup_to_external_disk_lib/raw/main/images/dropbox_1.png" alt="dropbox_1" title="dropbox_1" style="max-width: 100%;"></a>
Use this command to store the token (encrypted) in env variable. It will ask for your interactive input like a secret password.</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="dropbox_backup_to_external_disk_cli encode_token"><pre>dropbox_backup_to_external_disk_cli encode_token</pre></div>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">Open-source and free as a beer</h2><a id="user-content-open-source-and-free-as-a-beer" class="anchor" aria-label="Permalink: Open-source and free as a beer" href="#open-source-and-free-as-a-beer"></a></div>
<p dir="auto">My open-source projects are free as a beer (MIT license).<br>
I just love programming.<br>
But I need also to drink. If you find my projects and tutorials helpful, please buy me a beer by donating to my <a href="https://paypal.me/LucianoBestia" rel="nofollow">PayPal</a>.<br>
You know the price of a beer in your local bar ;-)<br>
So I can drink a free beer for your health :-)<br>
<a href="https://translate.google.com/?hl=en&amp;sl=sl&amp;tl=en&amp;text=Na%20zdravje&amp;op=translate" rel="nofollow">Na zdravje!</a> <a href="https://dictionary.cambridge.org/dictionary/italian-english/alla-salute" rel="nofollow">Alla salute!</a> <a href="https://dictionary.cambridge.org/dictionary/german-english/prost" rel="nofollow">Prost!</a> <a href="https://matadornetwork.com/nights/how-to-say-cheers-in-50-languages/" rel="nofollow">Nazdravlje!</a> üçª</p>
<p dir="auto"><a href="https://bestia.dev" rel="nofollow">//bestia.dev</a><br>
<a href="https://github.com/bestia-dev">//github.com/bestia-dev</a><br>
<a href="https://bestiadev.substack.com" rel="nofollow">//bestiadev.substack.com</a><br>
<a href="https://youtube.com/@bestia-dev-tutorials" rel="nofollow">//youtube.com/@bestia-dev-tutorials</a></p>
</article>
</body>

</html>