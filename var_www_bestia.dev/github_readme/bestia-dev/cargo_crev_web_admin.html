<!DOCTYPE html>
<html>

<head>
    <title>cargo_crev_web_admin</title>
    <meta http-equiv="Content-type" content="text/html;charset=utf-8" />
    <meta name="Description" content="Admin CLI for cargo_crev_web">
    <meta name="author" content="https://github.com/bestia-dev">
    <meta name=viewport content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/bestia01.css">
</head>

<body>
    <header>
        <nav>
            <a href="https://bestia.dev/index.html">bestia.dev</a>
        </nav>
    </header>
    <div>&nbsp;</div> 
    <div class="small"><a id="navbar_brand" href="https://bestia.dev" style="justify-content: center;">
                <img src="https://bestia.dev/images/bestia_icon.png" alt="bestia.dev" title="bestia.dev" />
            </a>This is a copy of the Github readme. Find the original on <a href="https://github.com/bestia-dev/cargo_crev_web_admin">https://github.com/bestia-dev/cargo_crev_web_admin</a></div>

<article class="markdown-body entry-content container-lg" itemprop="text">
<div class="markdown-heading" dir="auto"><h1 tabindex="-1" class="heading-element" dir="auto">cargo_crev_web_admin</h1><a id="user-content-cargo_crev_web_admin" class="anchor" aria-label="Permalink: cargo_crev_web_admin" href="#cargo_crev_web_admin"></a></div>
<p dir="auto"><strong>Admin CLI for cargo_crev_web</strong><br>
<em><strong>version: 2023.608.746 date: 2023-06-08 author: <a href="https://bestia.dev" rel="nofollow">bestia.dev</a> repository: <a href="https://github.com/bestia-dev/cargo_crev_web_admin/">Github</a></strong></em></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/e8100395d149fab3d02c3ee4672d2cc5d833bf4ab9044e6c57f47c54baf4d1ba/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6d61696e7461696e65642d677265656e"><img src="https://img.shields.io/badge/maintained-green" alt="maintained" style="max-width: 100%;"></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/3d28e085cfc1f662a567e40863593879fb9896391cde406b9ff5775277affe41/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f72656164795f666f725f7573652d677265656e"><img src="https://img.shields.io/badge/ready_for_use-green" alt="ready_for_use" style="max-width: 100%;"></a></p>
<p dir="auto"><a href="https://github.com/bestia-dev/cargo_crev_web_admin/"><img src="https://img.shields.io/badge/Lines_in_Rust-1113-green.svg" alt="Lines in Rust code" style="max-width: 100%;"></a>
<a href="https://github.com/bestia-dev/cargo_crev_web_admin/"><img src="https://img.shields.io/badge/Lines_in_Doc_comments-207-blue.svg" alt="Lines in Doc comments" style="max-width: 100%;"></a>
<a href="https://github.com/bestia-dev/cargo_crev_web_admin/"><img src="https://img.shields.io/badge/Lines_in_comments-126-purple.svg" alt="Lines in Comments" style="max-width: 100%;"></a>
<a href="https://github.com/bestia-dev/cargo_crev_web_admin/"><img src="https://img.shields.io/badge/Lines_in_examples-0-yellow.svg" alt="Lines in examples" style="max-width: 100%;"></a>
<a href="https://github.com/bestia-dev/cargo_crev_web_admin/"><img src="https://img.shields.io/badge/Lines_in_tests-36-orange.svg" alt="Lines in tests" style="max-width: 100%;"></a></p>
<p dir="auto"><a href="https://github.com/bestia-dev/cargo_crev_web_admin/blob/main/LICENSE"><img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="License" style="max-width: 100%;"></a>
<a href="https://github.com/bestia-dev/cargo_crev_web_admin/"><img src="https://github.com/bestia-dev/cargo_crev_web_admin/workflows/rust_fmt_auto_build_test/badge.svg" alt="Rust" style="max-width: 100%;"></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/ffa4a7c106f5aed8e88c778771e7855853287fd57ceeff4a1402ab96423bf3da/68747470733a2f2f6265737469612e6465762f776562706167655f6869745f636f756e7465722f6765745f7376675f696d6167652f3931313033313131302e737667"><img src="https://bestia.dev/webpage_hit_counter/get_svg_image/911031110.svg" alt="cargo_crev_web_admin" style="max-width: 100%;"></a></p>
<p dir="auto">Hashtags: #rustlang #buildtool #developmenttool #web #admin #cli<br>
My projects on Github are more like a tutorial than a finished product: <a href="https://github.com/bestia-dev/tutorials_rust_wasm">bestia-dev tutorials</a>.</p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">cargo_crev_web_admin CLI</h2><a id="user-content-cargo_crev_web_admin-cli" class="anchor" aria-label="Permalink: cargo_crev_web_admin CLI" href="#cargo_crev_web_admin-cli"></a></div>
<p dir="auto">The web app cargo_crev_web on <a href="https://web.crev.dev" rel="nofollow">https://web.crev.dev</a> fetches all proof repos it can find and shows the crate reviews online.<br>
Some admin tasks are needed and I don't want them to be accessible on the web.<br>
This will be a CLI app that can be used when logged on the linux terminal over SSH.<br>
So is sure that only an admin, who can log in on to the server, can use this tasks.</p>
<p dir="auto">Some tasks need the crev passphrase. Put it in the env variable before starting the CLI:<br>
<code>$  export CREV_PASSPHRASE=xxx</code><br>
Add a space before the command to avoid to be saved in the bash history.</p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">Development</h2><a id="user-content-development" class="anchor" aria-label="Permalink: Development" href="#development"></a></div>
<p dir="auto">I use <a href="https://crates.io/crates/cargo-auto" rel="nofollow">cargo-auto</a> for automation tasks in rust language. Install it:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="cargo install cargo-auto"><pre>cargo install cargo-auto</pre></div>
<p dir="auto">List user-defined automation tasks in <code>automation_tasks_rs</code>:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="cargo auto"><pre>cargo auto</pre></div>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">bash auto-completion</h2><a id="user-content-bash-auto-completion" class="anchor" aria-label="Permalink: bash auto-completion" href="#bash-auto-completion"></a></div>
<p dir="auto">This executable is prepared for auto-completion in bash.<br>
Run this command to define auto-completion in bash for the current session:<br>
Or add it to <code>.bashrc</code> file to be executed n every session start.</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="complete -C &quot;cargo_crev_web_admin completion&quot; cargo_crev_web_admin"><pre><span class="pl-c1">complete</span> -C <span class="pl-s"><span class="pl-pds">"</span>cargo_crev_web_admin completion<span class="pl-pds">"</span></span> cargo_crev_web_admin</pre></div>
<p dir="auto">To make it permanent add this command to the file <code>~/.bashrc</code> or some other file that runs commands on bash initialization.</p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">Prepare development environment</h2><a id="user-content-prepare-development-environment" class="anchor" aria-label="Permalink: Prepare development environment" href="#prepare-development-environment"></a></div>
<p dir="auto">In the development environment inside a container I need the <code>cargo-crev</code> binary to run the commands. Fortunately there is a binary release already compiled:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="curl -L -s https://github.com/crev-dev/cargo-crev/releases/download/v0.23.3/cargo-crev-v0.23.3-x86_64-unknown-linux-musl.tar.gz --output /tmp/cargo-crev.tar.gz
tar -xzv --no-same-owner --strip-components=1 -C ~/.cargo/bin -f /tmp/cargo-crev.tar.gz cargo-crev-v0.23.3-x86_64-unknown-linux-musl/cargo-crev
rm /tmp/cargo-crev.tar.gz
chmod +x ~/.cargo/bin/cargo-crev
git config --global core.editor &quot;nano&quot;"><pre>curl -L -s https://github.com/crev-dev/cargo-crev/releases/download/v0.23.3/cargo-crev-v0.23.3-x86_64-unknown-linux-musl.tar.gz --output /tmp/cargo-crev.tar.gz
tar -xzv --no-same-owner --strip-components=1 -C <span class="pl-k">~</span>/.cargo/bin -f /tmp/cargo-crev.tar.gz cargo-crev-v0.23.3-x86_64-unknown-linux-musl/cargo-crev
rm /tmp/cargo-crev.tar.gz
chmod +x <span class="pl-k">~</span>/.cargo/bin/cargo-crev
git config --global core.editor <span class="pl-s"><span class="pl-pds">"</span>nano<span class="pl-pds">"</span></span></pre></div>
<p dir="auto">Now I need to import the <code>CrevId</code> from the server (ssh agent already has my ssh identity to connect to the server):</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="scp luciano_bestia@bestia.dev:/home/luciano_bestia/.config/crev/ids/UpOPNplVEwBS2RhF7SS9gSP3bPJlfg-ZEoZ89gEMDwU.yaml .
# Connecting standard input to the file with &lt;
cargo-crev crev id import &lt;UpOPNplVEwBS2RhF7SS9gSP3bPJlfg-ZEoZ89gEMDwU.yaml
cargo-crev crev id current
rm UpOPNplVEwBS2RhF7SS9gSP3bPJlfg-ZEoZ89gEMDwU.yaml"><pre>scp luciano_bestia@bestia.dev:/home/luciano_bestia/.config/crev/ids/UpOPNplVEwBS2RhF7SS9gSP3bPJlfg-ZEoZ89gEMDwU.yaml <span class="pl-c1">.</span>
<span class="pl-c"><span class="pl-c">#</span> Connecting standard input to the file with &lt;</span>
cargo-crev crev id import <span class="pl-k">&lt;</span>UpOPNplVEwBS2RhF7SS9gSP3bPJlfg-ZEoZ89gEMDwU.yaml
cargo-crev crev id current
rm UpOPNplVEwBS2RhF7SS9gSP3bPJlfg-ZEoZ89gEMDwU.yaml</pre></div>
<p dir="auto">I need the ssh keys from the server to connect to the github remote repository.</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="scp luciano_bestia@bestia.dev:/home/luciano_bestia/.ssh/web_crev_dev_for_github.pub ~/.ssh/
scp luciano_bestia@bestia.dev:/home/luciano_bestia/.ssh/web_crev_dev_for_github ~/.ssh/
# Be careful to not commit any secrets or private keys to github! 
chmod 400 ~/.ssh/web_crev_dev_for_github
# Add the ssh key to your running ssh-agent
ssh-add ~/.ssh/web_crev_dev_for_github
# configure the remote repository 
cargo-crev crev id set-url https://github.com/web-crev-dev/crev-proofs
# To test add a `dpc` as trusted
cargo-crev crev trust https://github.com/dpc/crev-proofs
# Now check the dir with 
cargo-crev crev repo dir"><pre>scp luciano_bestia@bestia.dev:/home/luciano_bestia/.ssh/web_crev_dev_for_github.pub <span class="pl-k">~</span>/.ssh/
scp luciano_bestia@bestia.dev:/home/luciano_bestia/.ssh/web_crev_dev_for_github <span class="pl-k">~</span>/.ssh/
<span class="pl-c"><span class="pl-c">#</span> Be careful to not commit any secrets or private keys to github! </span>
chmod 400 <span class="pl-k">~</span>/.ssh/web_crev_dev_for_github
<span class="pl-c"><span class="pl-c">#</span> Add the ssh key to your running ssh-agent</span>
ssh-add <span class="pl-k">~</span>/.ssh/web_crev_dev_for_github
<span class="pl-c"><span class="pl-c">#</span> configure the remote repository </span>
cargo-crev crev id set-url https://github.com/web-crev-dev/crev-proofs
<span class="pl-c"><span class="pl-c">#</span> To test add a `dpc` as trusted</span>
cargo-crev crev trust https://github.com/dpc/crev-proofs
<span class="pl-c"><span class="pl-c">#</span> Now check the dir with </span>
cargo-crev crev repo dir</pre></div>
<p dir="auto">I got: <code>~/.local/share/crev/proofs/github_com_web-crev-dev_crev-proofs-POHSrDcUUmA6qBxSX6zy1w</code>
It looks crev changed the dir from ~/.config/crev to ~/.local/share/crev in some version. Be careful!</p>
<p dir="auto">On every session I will need to add the ssh key to the running ssh-agent:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="ssh-add ~/.ssh/web_crev_dev_for_github"><pre>ssh-add <span class="pl-k">~</span>/.ssh/web_crev_dev_for_github</pre></div>
<p dir="auto">Copy the new crev data from the server for developing and debugging. The web.crev.dev has a special crev-id and should not interfere with other crev-ids on the system.</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="rm ~/.local/share/crev/proofs/github_com_web-crev-dev_crev-proofs-POHSrDcUUmA6qBxSX6zy1w/UpOPNplVEwBS2RhF7SS9gSP3bPJlfg-ZEoZ89gEMDwU/blocklisted_repos.json
scp luciano_bestia@bestia.dev:/var/www/webapps/cargo_crev_web/blocklisted_repos.json ~/.local/share/crev/proofs/github_com_web-crev-dev_crev-proofs-POHSrDcUUmA6qBxSX6zy1w/UpOPNplVEwBS2RhF7SS9gSP3bPJlfg-ZEoZ89gEMDwU/blocklisted_repos.json
ls -l ~/.local/share/crev/proofs/github_com_web-crev-dev_crev-proofs-POHSrDcUUmA6qBxSX6zy1w/UpOPNplVEwBS2RhF7SS9gSP3bPJlfg-ZEoZ89gEMDwU

rm -r ~/.local/share/crev/proofs/github_com_web-crev-dev_crev-proofs-POHSrDcUUmA6qBxSX6zy1w/UpOPNplVEwBS2RhF7SS9gSP3bPJlfg-ZEoZ89gEMDwU/trust/

scp -r luciano_bestia@bestia.dev:/home/luciano_bestia/.local/share/crev/proofs/github_com_web-crev-dev_crev-proofs-POHSrDcUUmA6qBxSX6zy1w/UpOPNplVEwBS2RhF7SS9gSP3bPJlfg-ZEoZ89gEMDwU/trust/ ~/.local/share/crev/proofs/github_com_web-crev-dev_crev-proofs-POHSrDcUUmA6qBxSX6zy1w/UpOPNplVEwBS2RhF7SS9gSP3bPJlfg-ZEoZ89gEMDwU/
ls -l ~/.local/share/crev/proofs/github_com_web-crev-dev_crev-proofs-POHSrDcUUmA6qBxSX6zy1w/UpOPNplVEwBS2RhF7SS9gSP3bPJlfg-ZEoZ89gEMDwU/trust/
# list only the directly trusted repos
cargo-crev crev id query trusted --high-cost 1 --medium-cost 1 --low-cost 1 --depth 1"><pre>rm <span class="pl-k">~</span>/.local/share/crev/proofs/github_com_web-crev-dev_crev-proofs-POHSrDcUUmA6qBxSX6zy1w/UpOPNplVEwBS2RhF7SS9gSP3bPJlfg-ZEoZ89gEMDwU/blocklisted_repos.json
scp luciano_bestia@bestia.dev:/var/www/webapps/cargo_crev_web/blocklisted_repos.json <span class="pl-k">~</span>/.local/share/crev/proofs/github_com_web-crev-dev_crev-proofs-POHSrDcUUmA6qBxSX6zy1w/UpOPNplVEwBS2RhF7SS9gSP3bPJlfg-ZEoZ89gEMDwU/blocklisted_repos.json
ls -l <span class="pl-k">~</span>/.local/share/crev/proofs/github_com_web-crev-dev_crev-proofs-POHSrDcUUmA6qBxSX6zy1w/UpOPNplVEwBS2RhF7SS9gSP3bPJlfg-ZEoZ89gEMDwU

rm -r <span class="pl-k">~</span>/.local/share/crev/proofs/github_com_web-crev-dev_crev-proofs-POHSrDcUUmA6qBxSX6zy1w/UpOPNplVEwBS2RhF7SS9gSP3bPJlfg-ZEoZ89gEMDwU/trust/

scp -r luciano_bestia@bestia.dev:/home/luciano_bestia/.local/share/crev/proofs/github_com_web-crev-dev_crev-proofs-POHSrDcUUmA6qBxSX6zy1w/UpOPNplVEwBS2RhF7SS9gSP3bPJlfg-ZEoZ89gEMDwU/trust/ <span class="pl-k">~</span>/.local/share/crev/proofs/github_com_web-crev-dev_crev-proofs-POHSrDcUUmA6qBxSX6zy1w/UpOPNplVEwBS2RhF7SS9gSP3bPJlfg-ZEoZ89gEMDwU/
ls -l <span class="pl-k">~</span>/.local/share/crev/proofs/github_com_web-crev-dev_crev-proofs-POHSrDcUUmA6qBxSX6zy1w/UpOPNplVEwBS2RhF7SS9gSP3bPJlfg-ZEoZ89gEMDwU/trust/
<span class="pl-c"><span class="pl-c">#</span> list only the directly trusted repos</span>
cargo-crev crev id query trusted --high-cost 1 --medium-cost 1 --low-cost 1 --depth 1</pre></div>
<p dir="auto">This should list around 80 directly trusted proof-repos that are used on the server.</p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">TODO</h2><a id="user-content-todo" class="anchor" aria-label="Permalink: TODO" href="#todo"></a></div>
<p dir="auto">Integrity - warnings if a review have incorrect url or ID</p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">Open-source and free as a beer</h2><a id="user-content-open-source-and-free-as-a-beer" class="anchor" aria-label="Permalink: Open-source and free as a beer" href="#open-source-and-free-as-a-beer"></a></div>
<p dir="auto">My open-source projects are free as a beer (MIT license).<br>
I just love programming.<br>
But I need also to drink. If you find my projects and tutorials helpful, please buy me a beer by donating to my <a href="https://paypal.me/LucianoBestia" rel="nofollow">PayPal</a>.<br>
You know the price of a beer in your local bar ;-)<br>
So I can drink a free beer for your health :-)<br>
<a href="https://translate.google.com/?hl=en&amp;sl=sl&amp;tl=en&amp;text=Na%20zdravje&amp;op=translate" rel="nofollow">Na zdravje!</a> <a href="https://dictionary.cambridge.org/dictionary/italian-english/alla-salute" rel="nofollow">Alla salute!</a> <a href="https://dictionary.cambridge.org/dictionary/german-english/prost" rel="nofollow">Prost!</a> <a href="https://matadornetwork.com/nights/how-to-say-cheers-in-50-languages/" rel="nofollow">Nazdravlje!</a> 🍻</p>
<p dir="auto"><a href="https://bestia.dev" rel="nofollow">//bestia.dev</a><br>
<a href="https://github.com/bestia-dev">//github.com/bestia-dev</a><br>
<a href="https://bestiadev.substack.com" rel="nofollow">//bestiadev.substack.com</a><br>
<a href="https://youtube.com/@bestia-dev-tutorials" rel="nofollow">//youtube.com/@bestia-dev-tutorials</a></p>
</article>
</body>

</html>